(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1181:function(e,t,n){Promise.resolve().then(n.bind(n,6774))},6774:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(7437),s=n(2265),a=n(6463),o=n(3681),i=n(6972),l=n(2867),u=n(7540);function c(e){let{user:t}=e,n=(0,a.useRouter)(),[o,i]=(0,s.useState)([]),[c,d]=(0,s.useState)(!0),[m,f]=(0,s.useState)(null),[h,x]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=!0;return d(!0),f(null),(0,u.fx)(t.uid).then(t=>{e&&i(t)}).catch(t=>{e&&f("MyLogの読み込みに失敗しました。"),console.error(t)}).finally(()=>{e&&d(!1)}),()=>{e=!1}},[t.uid]),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("button",{type:"button",disabled:h,onClick:async()=>{x(!0),f(null);try{let e=await (0,u.he)(t.uid);n.push("/plans/".concat(encodeURIComponent(e)))}catch(e){f("新しいLogの作成に失敗しました。"),console.error(e)}finally{x(!1)}},className:"w-full rounded-2xl border border-dashed border-slate-200 bg-white py-4 text-sm font-semibold text-slate-600 shadow-cardSoft transition hover:bg-slate-50 disabled:opacity-60",children:h?"作成中...":"新しいLogを作成"}),m?(0,r.jsx)("div",{className:"rounded-2xl bg-white p-4 text-sm text-rose-500 shadow-cardSoft",children:m}):null,c?(0,r.jsx)("div",{className:"rounded-2xl bg-white p-4 text-sm text-slate-500 shadow-cardSoft",children:"読み込み中..."}):0===o.length?(0,r.jsx)("div",{className:"rounded-2xl bg-white p-4 text-sm text-slate-500 shadow-cardSoft",children:"まだ旅行プランがありません。"}):o.map(e=>(0,r.jsx)(l.Z,{plan:e,canDelete:!0,onDelete:async e=>{try{await (0,u.Kh)(e.path),i(t=>t.filter(t=>t.path!==e.path))}catch(e){f("プランの削除に失敗しました。"),console.error(e)}}},e.path))]})}function d(){return(0,r.jsx)(o.Z,{children:e=>(0,r.jsx)(i.Z,{title:"MyLog",children:(0,r.jsx)(c,{user:e})})})}},2867:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(7437),s=n(2265),a=n(6463),o=n(7003);function i(e){let{plan:t,canDelete:n=!1,onDelete:i}=e,l=(0,a.useRouter)(),[u,c]=(0,s.useState)(0),[d,m]=(0,s.useState)(!1),f=(0,s.useRef)(null),h=(0,s.useRef)(!1),x=(0,s.useRef)(!1),p=(0,s.useRef)({x:0,y:0}),b=function(e){var t;if("number"!=typeof e.totalCost)return{percent:0,remainingLabel:"あと —",progressLabel:"—"};let n=null!==(t=Array.isArray(e.savingsHistory)?e.savingsHistory.reduce((e,t)=>{if("number"==typeof t)return e+t;if(t&&"object"==typeof t&&"amount"in t){let n=t.amount;return e+("number"==typeof n?n:0)}return e},0):"number"==typeof e.savedAmount?e.savedAmount:"number"==typeof e.amount?e.amount:null)&&void 0!==t?t:0,r=e.totalCost>0?e.totalCost:0,s=r>0?Math.min(100,Math.round(n/r*100)):0,a=Math.max(0,e.totalCost-n);return{percent:s,remainingLabel:"あと ".concat((0,o._z)(a)),progressLabel:"".concat(s,"%")}}(t),y="number"==typeof t.commentsCount?t.commentsCount:0,v=encodeURIComponent(t.path),j=()=>{if(h.current&&!d){if(h.current=!1,u<=-80&&n&&i){m(!0),c(0),f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(()=>{i(t)},220);return}c(0)}},w=()=>{if(d||x.current||Math.abs(u)>5){x.current=!1;return}l.push("/plans/".concat(v))},g=n&&u<-4&&!d;return(0,r.jsxs)("div",{className:"relative overflow-hidden rounded-2xl ".concat(d?"pointer-events-none animate-slide-out":""),children:[g?(0,r.jsx)("div",{className:"pointer-events-none absolute inset-0 rounded-2xl bg-rose-500"}):null,g?(0,r.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-end pr-6 text-sm font-semibold text-white",children:"削除"}):null,(0,r.jsxs)("div",{role:"button",tabIndex:0,onClick:w,onPointerDown:e=>{n&&!d&&(h.current=!0,x.current=!1,p.current={x:e.clientX,y:e.clientY},e.currentTarget.setPointerCapture(e.pointerId))},onPointerMove:e=>{if(!h.current||!n||d)return;let t=e.clientX-p.current.x,r=e.clientY-p.current.y;if(!x.current){if(6>Math.abs(t))return;if(Math.abs(t)<=Math.abs(r)){h.current=!1;return}x.current=!0}c(Math.max(-140,Math.min(0,t)))},onPointerUp:j,onPointerCancel:j,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&w()},className:"relative z-10 rounded-2xl card-surface p-4 shadow-cardSoft transition-transform hover:shadow-card duration-200 ease-out interactive-shadow will-change-transform",style:{transform:"translateX(".concat(u,"px)"),touchAction:"pan-y"},children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:t.name||"Untitled"}),(0,r.jsx)("p",{className:"text-sm text-slate-500",children:t.destination||"Destination"})]}),(0,r.jsxs)("div",{className:"text-right text-xs text-slate-500",children:[(0,r.jsx)("span",{className:"block text-base font-semibold text-slate-900",children:y}),"コメント"]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[(0,r.jsx)("span",{children:b.remainingLabel}),(0,r.jsx)("span",{children:b.progressLabel})]}),(0,r.jsx)("div",{className:"mt-2 h-2 rounded-full bg-slate-100",children:(0,r.jsx)("div",{className:"h-2 rounded-full bg-slate-900/80",style:{width:"".concat(b.percent,"%")}})})]})]})]})}},7003:function(e,t,n){"use strict";function r(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",maximumFractionDigits:0}).format(e)}function s(e){if(!e)return null;if(e instanceof Date)return e;if("string"==typeof e){let t=new Date(e);return Number.isNaN(t.getTime())?null:t}return"toDate"in e&&"function"==typeof e.toDate?e.toDate():null}function a(e){let t=s(e);return t?new Intl.DateTimeFormat("ja-JP",{dateStyle:"medium",timeStyle:"short"}).format(t):""}function o(e){let t=s(e);return t?new Intl.DateTimeFormat("ja-JP",{dateStyle:"medium"}).format(t):""}n.d(t,{_z:function(){return r},o0:function(){return a},p6:function(){return o}})}},function(e){e.O(0,[358,139,288,537,440,971,23,744],function(){return e(e.s=1181)}),_N_E=e.O()}]);